### Pruebas de endpoints del Marketplace de Servicios
### Microservicio: microo-service (ServiceController)
### Puerto: 8083

# Variables de entorno
@baseUrl = http://localhost:8083
@keycloakUrl = http://localhost:8180
@realm = microservices-ecosystem
@client_id = perfil-service
@client_secret = XhzE490FVJwoJ3OdLlyyqpDyIaf1lgVe
@username = testuser
@password = testpassword

#########################################################################
# SECCIÓN 1: AUTENTICACIÓN CON KEYCLOAK
#########################################################################


### ### Login with Basic User
# @name loginUser
POST http://localhost:8081/auth/login
Content-Type: application/json

{
  "username": "testprovider",
  "password": "password123"
}

### 1.2: Register a Provider (with additional provider fields)
# @name registerProvider
POST http://localhost:8081/auth/register/provider
Content-Type: application/json

{
  "username": "testprovider",
  "email": "provider@example.com",
  "firstName": "Test",
  "lastName": "Provider",
  "password": "password123",
  "age": 30,
  "photo": "iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==",
  "description": "Test provider for authentication testing",
  "phone": "+1234567890",
  "webPage": "https://testprovider.com",
  "socialMediaContact": "@testprovider"
}


###

# Variables de entorno
@baseUrl = http://localhost:8083
@authToken = Bearer {{ loginUser.response.body.accessToken }}

#########################################################################
# SECCIÓN 2: VERIFICACIÓN DE SALUD Y SERVICIOS INICIALES
#########################################################################

### 1. Verificar salud del servicio
GET {{baseUrl}}/api/v1/services/health
Authorization: {{authToken}}
Content-Type: application/json

###

### 2. Obtener todos los servicios (debe estar vacío inicialmente)
# @name getAllServices
GET {{baseUrl}}/api/v1/services
Authorization: {{authToken}}
Content-Type: application/json

###

### 3. Buscar servicio por ID (debe retornar 404 para servicio inexistente)
GET {{baseUrl}}/api/v1/services/550e8400-e29b-41d4-a716-446655440000
Authorization: {{authToken}}
Content-Type: application/json
###

#########################################################################
# SECCIÓN 3: CREAR SERVICIOS EN EL MARKETPLACE
#########################################################################

### 4. Crear primer servicio - Desarrollo Web
# @name createWebService
POST {{baseUrl}}/api/v1/services
Authorization: {{authToken}}
Content-Type: application/json

{
  "title": "Desarrollo Web Profesional",
  "description": "Servicios de desarrollo web",
  "price": 299.99,
  "averageRating": 4.5
}



###

### 5. Crear segundo servicio - Desarrollo Móvil
# @name createMobileService
POST {{baseUrl}}/api/v1/services
Authorization: {{authToken}}
Content-Type: application/json

{
  "title": "Desarrollo de Apps Móviles",
  "description": "Desarrollo de aplicaciones nativas y multiplataforma para iOS y Android",
  "price": 499.99,
  "averageRating": 4.8
}

###

### 6. Crear tercer servicio - Consultoría IT
# @name createConsultingService
POST {{baseUrl}}/api/v1/services
Authorization: {{authToken}}
Content-Type: application/json

{
  "title": "Consultoría en Tecnología",
  "description": "Asesoramiento especializado en arquitectura de software y transformación digital",
  "price": 150.00,
  "averageRating": 4.9
}


### 7. Actualizar precio y descripción del servicio web
# @name updateWebService

PUT {{baseUrl}}/api/v1/services/{{ createWebService.response.body.id }}
Authorization: {{authToken}}
Content-Type: application/json

{
  "title": "Desarrollo Web Profesional - ACTUALIZADO",
  "description": "Servicios premium de desarrollo web con tecnologías de última generación y soporte completo",
  "price": 379.99,
  "averageRating": 3.9
}



###

### 7. Verificar servicios creados
# @name servicesAfterCreation
GET {{baseUrl}}/api/v1/services
Authorization: {{authToken}}

###

#########################################################################
# SECCIÓN 4: OBTENER SERVICIOS ESPECÍFICOS
#########################################################################

### 8. Obtener servicio web por ID
GET {{baseUrl}}/api/v1/services/{{ createWebService.response.body.id }}
Authorization: {{authToken}}

###

### 9. Obtener servicio móvil por ID
GET {{baseUrl}}/api/v1/services/{{ createMobileService.response.body.id }}
Authorization: {{authToken}}

###

### 10. Obtener servicio de consultoría por ID
GET {{baseUrl}}/api/v1/services/{{ createConsultingService.response.body.id }}
Authorization: {{authToken}}

###

# ------------------------------------------------
# Verificar comentarios de un servicio específico
# ------------------------------------------------

@serviceId = 7dd565d2-d195-4d94-8d23-8de0bd78c5e1

### Obtener un servicio específico por ID
# @name getServiceById
GET {{ baseUrl }}/api/v1/services/{{serviceId}}
Authorization: {{ keycloakToken }}


### Obtiene todos los comentarios de un servicio específico
GET {{ baseUrl }}/api/v1/services/{{serviceId}}/comments
Authorization: {{ keycloakToken }}

###

### Obtiene el conteo de comentarios de un servicio específico
GET {{ baseUrl }}/api/v1/services/{{serviceId}}/comments/count
Authorization: {{ keycloakToken }}


#########################################################################
# SECCIÓN 5: ACTUALIZAR SERVICIOS
#########################################################################

### 11. Actualizar precio y descripción del servicio web
# @name updateWebService
PUT {{baseUrl}}/api/v1/services/{{ createWebService.response.body.id }}
Authorization: {{authToken}}
Content-Type: application/json

{
  "title": "Desarrollo Web Profesional - ACTUALIZADO",
  "description": "Servicios premium de desarrollo web con tecnologías de última generación y soporte completo",
  "price": 349.99,
  "category": "TECHNOLOGY",
  "providerId": "550e8400-e29b-41d4-a716-446655440001",
  "isActive": true,
  "averageRating": 4.7
}


#########################################################################
# SECCIÓN 6: GRAPHQL TESTS
#########################################################################

### 13. GraphQL - Obtener todos los servicios
# @name getAllServicesGraphQL
POST {{baseUrl}}/graphql
Authorization: {{authToken}}
Content-Type: application/json

{
  "query": "{ services { id title description price averageRating } }"
}

###

### 14. GraphQL - Obtener servicios con filtro por título
# @name getServicesWithTitleFilter
POST {{baseUrl}}/graphql
Authorization: {{authToken}}
Content-Type: application/json

{
  "query": "{ services(title: \"Web\") { id title description price averageRating } }"
}

###

### 15. GraphQL - Obtener servicios con filtro de precio
# @name getServicesWithPriceFilter
POST {{baseUrl}}/graphql
Authorization: {{authToken}}
Content-Type: application/json

{
  "query": "{ services(minPrice: 200.0, maxPrice: 400.0) { id title description price averageRating } }"
}

###

### 16. GraphQL - Obtener servicio específico por ID
# @name getServiceByIdGraphQL
POST {{baseUrl}}/graphql
Authorization: {{authToken}}
Content-Type: application/json

{
  "query": "{ serviceById(id: \"{{createWebService.response.body.id}}\") { id title description price averageRating } }"
}

###

### 17. GraphQL - Query con múltiples filtros
# @name getServicesMultipleFilters
POST {{baseUrl}}/graphql
Authorization: {{authToken}}
Content-Type: application/json

{
  "query": "{ services(title: \"Desarrollo\", minPrice: 100.0, maxPrice: 500.0) { id title description price averageRating } }"
}

###

### 18. GraphQL - Query con variables (formato alternativo)
# @name getServiceWithVariables
POST {{baseUrl}}/graphql
Authorization: {{authToken}}
Content-Type: application/json

{
  "query": "query GetService($serviceId: ID!) { serviceById(id: $serviceId) { id title description price averageRating } }",
  "variables": {
    "serviceId": "{{createWebService.response.body.id}}"
  }
}

###

### 19. GraphQL - Consulta compleja con alias
# @name getServicesWithAlias
POST {{baseUrl}}/graphql
Authorization: {{authToken}}
Content-Type: application/json

{
  "query": "{ cheapServices: services(maxPrice: 200.0) { id title price } expensiveServices: services(minPrice: 400.0) { id title price } }"
}

###

### 20. GraphQL - Verificar servicio que no existe
# @name getNonExistentService
POST {{baseUrl}}/graphql
Authorization: {{authToken}}
Content-Type: application/json

{
  "query": "{ serviceById(id: \"550e8400-e29b-41d4-a716-446655440000\") { id title description price averageRating } }"
}

###

#########################################################################
# SECCIÓN 7: GRAPHQL - TESTS SIN AUTENTICACIÓN (SI GRAPHQL ES PÚBLICO)
#########################################################################

### 21. GraphQL Sin Auth - Obtener todos los servicios
# @name getAllServicesGraphQLNoAuth
POST {{baseUrl}}/graphql
Content-Type: application/json

{
  "query": "{ services { id title price } }"
}

###

### 22. GraphQL Sin Auth - Obtener servicio por ID
# @name getServiceByIdNoAuth
POST {{baseUrl}}/graphql
Content-Type: application/json

{
  "query": "{ serviceById(id: \"{{createWebService.response.body.id}}\") { id title price } }"
}

###

#########################################################################
# SECCIÓN 8: GEOAPIFY API - LOCATION SERVICES
#########################################################################

### 23. Geocode an address (Convert address to coordinates)
# @name geocodeAddress
GET {{baseUrl}}/api/v1/location/geocode?address=Madrid, Spain
Authorization: {{authToken}}
Content-Type: application/json

###

### 24. Geocode address - Barcelona
# @name geocodeBarcelona
GET {{baseUrl}}/api/v1/location/geocode?address=Barcelona, Spain
Authorization: {{authToken}}
Content-Type: application/json

###

### 25. Geocode address - New York
# @name geocodeNewYork
GET {{baseUrl}}/api/v1/location/geocode?address=New York, USA
Authorization: {{authToken}}
Content-Type: application/json

###

### 26. Reverse geocode (Convert coordinates to address)
# @name reverseGeocode
GET {{baseUrl}}/api/v1/location/reverse-geocode?lat=40.4168&lon=-3.7038
Authorization: {{authToken}}
Content-Type: application/json

###

### 27. Reverse geocode - Paris coordinates
# @name reverseGeocodeParis
GET {{baseUrl}}/api/v1/location/reverse-geocode?lat=48.8566&lon=2.3522
Authorization: {{authToken}}
Content-Type: application/json

###

### 28. Search for places - Restaurants in Barcelona
# @name searchPlacesRestaurants
GET {{baseUrl}}/api/v1/location/places?query=restaurants in Barcelona
Authorization: {{authToken}}
Content-Type: application/json

###

### 29. Search for places - Hotels in Madrid
# @name searchPlacesHotels
GET {{baseUrl}}/api/v1/location/places?query=hotels in Madrid
Authorization: {{authToken}}
Content-Type: application/json

###

### 30. Search for places - Museums in Paris
# @name searchPlacesMuseums
GET {{baseUrl}}/api/v1/location/places?query=museums in Paris
Authorization: {{authToken}}
Content-Type: application/json

###

#########################################################################
# SECCIÓN 9: OPEN-METEO API - WEATHER SERVICES
#########################################################################

### 31. Get current weather for Madrid coordinates
# @name getCurrentWeatherMadrid
GET {{baseUrl}}/api/v1/weather/current?lat=40.4168&lon=-3.7038
Authorization: {{authToken}}
Content-Type: application/json

###

### 32. Get current weather for Barcelona
# @name getCurrentWeatherBarcelona
GET {{baseUrl}}/api/v1/weather/current?lat=41.3851&lon=2.1734
Authorization: {{authToken}}
Content-Type: application/json

###

### 33. Get current weather for New York
# @name getCurrentWeatherNewYork
GET {{baseUrl}}/api/v1/weather/current?lat=40.7128&lon=-74.0060
Authorization: {{authToken}}
Content-Type: application/json

###

### 34. Get weather forecast - Madrid (7 days default)
# @name getForecastMadrid
GET {{baseUrl}}/api/v1/weather/forecast?lat=40.4168&lon=-3.7038&days=7
Authorization: {{authToken}}
Content-Type: application/json

###

### 35. Get weather forecast - Barcelona (3 days)
# @name getForecastBarcelona
GET {{baseUrl}}/api/v1/weather/forecast?lat=41.3851&lon=2.1734&days=3
Authorization: {{authToken}}
Content-Type: application/json

###

### 36. Get weather forecast - Paris (14 days)
# @name getForecastParis
GET {{baseUrl}}/api/v1/weather/forecast?lat=48.8566&lon=2.3522&days=14
Authorization: {{authToken}}
Content-Type: application/json

###

### 37. Get hourly weather forecast - Madrid (48 hours default)
# @name getHourlyForecastMadrid
GET {{baseUrl}}/api/v1/weather/hourly?lat=40.4168&lon=-3.7038&hours=48
Authorization: {{authToken}}
Content-Type: application/json

###

### 38. Get hourly weather forecast - Barcelona (24 hours)
# @name getHourlyForecastBarcelona
GET {{baseUrl}}/api/v1/weather/hourly?lat=41.3851&lon=2.1734&hours=24
Authorization: {{authToken}}
Content-Type: application/json

###

### 39. Get hourly weather forecast - New York (72 hours)
# @name getHourlyForecastNewYork
GET {{baseUrl}}/api/v1/weather/hourly?lat=40.7128&lon=-74.0060&hours=72
Authorization: {{authToken}}
Content-Type: application/json

###

#########################################################################
# SECCIÓN 10: INTEGRATED WORKFLOW - LOCATION + WEATHER
#########################################################################

### 40. Complete workflow: Geocode address then get weather
# Step 1: Geocode an address to get coordinates
# @name workflowGeocode
GET {{baseUrl}}/api/v1/location/geocode?address=Paris, France
Authorization: {{authToken}}
Content-Type: application/json

# Step 2: Use coordinates from Step 1 to get current weather
# Note: Replace lat/lon with actual values from geocode response
# GET {{baseUrl}}/api/v1/weather/current?lat=48.8566&lon=2.3522
# Authorization: {{authToken}}

###

### 41. Complete workflow: Reverse geocode then get forecast
# Step 1: Reverse geocode coordinates to get address
# @name workflowReverseGeocode
GET {{baseUrl}}/api/v1/location/reverse-geocode?lat=40.4168&lon=-3.7038
Authorization: {{authToken}}
Content-Type: application/json

# Step 2: Get weather forecast for the same coordinates
# GET {{baseUrl}}/api/v1/weather/forecast?lat=40.4168&lon=-3.7038&days=7
# Authorization: {{authToken}}

###

